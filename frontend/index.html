<!-- services/api-gateway/static/index.html
     GeoLocate MVP — страница без сборщиков:
     - Регистрация/Вход
     - Загрузка фото
     - Поиск по адресу (карта + превью)
     - Список фото с пагинацией
     - Детекции
-->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>GeoLocate MVP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Leaflet (карта) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    body { font-family: system-ui, Segoe UI, Arial, sans-serif; margin: 16px; }
    .row { display:flex; gap:16px; flex-wrap: wrap; }
    .card { border:1px solid #ddd; border-radius:10px; padding:12px; box-shadow:0 1px 4px rgba(0,0,0,.04); }
    label { display:block; margin-top:8px; }
    input[type="text"], input[type="password"], select { width: 240px; padding:6px; }
    button { padding:6px 10px; cursor:pointer; }
    table { border-collapse: collapse; width:100%; }
    th, td { border: 1px solid #ddd; padding: 6px 8px; }
    /* Поиск */
    #search_results { display:grid; grid-template-columns: repeat(auto-fill, minmax(180px,1fr)); gap:12px; }
    .card-photo { border:1px solid #e5e7eb; border-radius:10px; overflow:hidden; }
    .card-photo .thumb { display:block; aspect-ratio:4/3; background:#f6f7f9; }
    .card-photo img { width:100%; height:100%; object-fit:cover; display:block; }
    .card-photo .meta { padding:8px; font:12px/1.4 system-ui,Arial; }
    .ellipsis { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    /* Карта */
    #map { width:100%; height: 360px; border:1px solid #e5e7eb; border-radius:10px; }
    /* Пагинация */
    .pager { display:flex; gap:8px; align-items:center; margin:8px 0; flex-wrap:wrap; }
    .pager .spacer { flex:1 1 auto; }
  </style>
</head>
<body>
  <h1>GeoLocate MVP</h1>

  <!-- Статус авторизации -->
  <header style="display:flex;gap:12px;align-items:center;">
    <div id="authStatus">Гость</div>
    <button id="logoutBtn" style="display:none;">Выйти</button>
  </header>

  <div class="row">
    <!-- Регистрация -->
    <div class="card">
      <h3>Регистрация</h3>
      <label>Имя <input id="reg_name" type="text"></label>
      <label>Пароль <input id="reg_pass" type="password"></label>
      <label>Роль <input id="reg_role" type="text" value="user"></label>
      <button id="btnRegister" type="button">Зарегистрировать</button>
      <div id="reg_out"></div>
    </div>

    <!-- Вход -->
    <div class="card">
      <h3>Вход</h3>
      <label>Имя <input id="login_name" type="text" value="admin"></label>
      <label>Пароль <input id="login_pass" type="password" value="admin"></label>
      <button id="btnLogin" type="button">Войти</button>
      <div id="login_out"></div>
    </div>

    <!-- Загрузка фото -->
    <div class="card">
      <h3>Загрузка фото</h3>
      <input id="file" type="file" accept="image/*">
      <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
        <input id="type" type="text" placeholder="type (опц.)" style="width:140px;">
        <input id="subtype" type="text" placeholder="subtype (опц.)" style="width:160px;">
        <input id="shot_lat" type="text" placeholder="lat (опц.)" style="width:140px;">
        <input id="shot_lon" type="text" placeholder="lon (опц.)" style="width:140px;">
        <input id="meta" type="file" accept="application/json">
      </div>
      <button id="btnUpload" type="button" style="margin-top:6px;">Загрузить</button>
      <div id="upload_out"></div>
    </div>
  </div>

  <!-- Поиск по адресу -->
  <section style="margin-top:20px">
    <h2>Поиск по адресу</h2>
    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
      <label for="addr">Адрес:</label>
      <input id="addr" type="text" placeholder="Амурская улица, д. 2, к. 1" style="min-width:360px" />
      <button id="btnSearchAddress" type="button">Искать</button>
      <div id="search_meta" style="margin-left:auto;color:#444;"></div>
    </div>

    <!-- Карта Leaflet -->
    <div id="map" style="margin-top:10px"></div>

    <!-- Сетка превью -->
    <div id="search_results" style="margin-top:12px"></div>

    <!-- Сырой ответ для отладки -->
    <pre id="search_out"
         style="background:#f6f8fa;border:1px solid #eaecef;padding:10px;margin-top:10px;max-height:260px;overflow:auto"></pre>
  </section>

  <hr/>

  <div class="row">
    <!-- Фотографии + пагинация -->
    <div class="card" style="min-width:380px; flex:1 1 520px;">
      <h3>Фотографии</h3>

      <div class="pager">
        <div>
          На странице:
          <select id="photos_page_size">
            <option>25</option>
            <option selected>50</option>
            <option>100</option>
            <option>200</option>
          </select>
        </div>
        <div class="spacer"></div>
        <button id="btnPrevPhotos" type="button">← Пред</button>
        <span id="photos_page_info">стр. 1</span>
        <button id="btnNextPhotos" type="button">След →</button>
        <button id="btnLoadPhotos" type="button" title="Обновить текущую страницу">Обновить</button>
      </div>

      <div id="photos"></div>
    </div>

    <!-- Детекции -->
    <div class="card" style="min-width:420px;">
      <h3>Детекции (по photo_id)</h3>
      <label>photo_id <input id="ph_id" type="text" style="width:90px"></label>
      <div class="row">
        <div>
          <label>x1 <input id="x1" type="text" value="10"></label>
          <label>y1 <input id="y1" type="text" value="10"></label>
        </div>
        <div>
          <label>x2 <input id="x2" type="text" value="120"></label>
          <label>y2 <input id="y2" type="text" value="120"></label>
        </div>
        <div>
          <label>label <input id="label" type="text" value="house"></label>
          <label>conf <input id="conf" type="text" value="0.9"></label>
        </div>
      </div>
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;">
        <button id="btnSendDetect" type="button">Сохранить bbox</button>
        <button id="btnLoadObjects" type="button">Загрузить список</button>
        <button id="btnCalc" type="button" title="Имитация расчёта для photo_id">Расчёт</button>
        <button id="btnExportXlsx" type="button" title="Экспорт всех объектов">Экспорт XLSX</button>
      </div>
      <div id="calc_out" style="margin-top:6px; color:#444;"></div>
      <div id="objects"></div>
    </div>
  </div>

  <script src="/app.js"></script>
</body>
</html>
